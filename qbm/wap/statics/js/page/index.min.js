define(function(require,module,exports){require("zepto"),template=require("artTemplate"),require("fastclick"),FastClick.attach(document.body),template.helper("labelPeriod",function(isDay,num,index){if("Y"==isDay)var unit="天";else var unit="个月";return"<span class='fc-3'>"+num+"</span>"+unit}),template.helper("labelTag",function(index,tag,bgColor){var tagArr=["按月付息","定制","定时","定向","可赎回"];return tag?0==index?"<span class='label_tag tuijian_tag' data-tag=tag"+tag+">"+tagArr[tag-1]+"</span>":"<span class='label_tag' data-tag=tag"+tag+">"+tagArr[tag-1]+"</span>":""}),template.helper("hasTag",function(tag){if(!tag)return"hide"}),template.helper("fixToSecond",function(value){return(1*value).toFixed(2)}),template.helper("rateMes",function(basic,reward){var basic=(1*basic).toFixed(2)+"",reward=(1*reward).toFixed(2)+"",basic_first=basic.split(".")[0],basic_second=basic.split(".")[1],rewardHtml="";return reward&&(rewardHtml="<span class='rate_small'>+"+reward+"%</span>"),"<span class='rate_large'>"+basic_first+".</span>"+basic_second+"%"+rewardHtml}),template.helper("BarProgress",function(hasSend,total){return hasSend/total*100}),template.helper("LabelStatus",function(status){return 0==status?"已售罄":1==status?"可投资":4==status?"待开售":void 0}),template.helper("LabelClass",function(status){return 0==status?"not_start":1==status?"":4==status?"not_start":void 0}),template.helper("LabelCircleState",function(status){return 0==status?"not_start":1==status?"is_start":4==status?"not_start":void 0}),$(function(){function browserRedirect(){var sUserAgent=navigator.userAgent.toLowerCase(),bIsIpad="ipad"==sUserAgent.match(/ipad/i),bIsIphoneOs="iphone os"==sUserAgent.match(/iphone os/i),bIsMidp="midp"==sUserAgent.match(/midp/i),bIsUc7="rv:1.2.3.4"==sUserAgent.match(/rv:1.2.3.4/i),bIsUc="ucweb"==sUserAgent.match(/ucweb/i),bIsAndroid="android"==sUserAgent.match(/android/i),bIsCE="windows ce"==sUserAgent.match(/windows ce/i),bIsWM="windows mobile"==sUserAgent.match(/windows mobile/i);bIsIpad||bIsIphoneOs||bIsMidp||bIsUc7||bIsUc||bIsAndroid||bIsCE||bIsWM||(location.href=weburl)}var weburl=$("#weburl").val();browserRedirect();var App=function(){this.url={wapUrl:$("#wapurl").val(),bannerList:"/api/getWapBanner.html",labelList:"/api/getBorrowList.html"},this.tpl={bannerTpl:template.compile($("#topBannerTpl").html()),labelListTpl:template.compile($("#borrow-list-template").html())},this.isLogin=function(){return $(".has_login_box").length>0}(),this.init(),this.slider(),this.loadList()};App.prototype={init:function(){$(window).width(),window.innerWidth,document.body.innerWidth;$("body").on("click",".tap-link",function(){var $elem=$(this),href=$elem.attr("data-href");""!=href&&(window.location.href=href)})},slider:function(){var self=this;require("swiper");var url=self.url.wapUrl+self.url.bannerList;$.ajax({url:url,dataType:"get",dataType:"jsonp",success:function(data){if(data.result)if(1==data.code){self.isLogin||data.imageResourcesList.forEach(function(item,index){1==item.isLoginSee&&data.imageResourcesList.splice(index,1)});var bannerhtml=self.tpl.bannerTpl(data);$("#indexSlider .swiper-wrapper").html(bannerhtml);var swiperCfg={loop:!0,autoHeight:!0,noSwiping:!0,autoplay:3e3,speed:400,autoplayDisableOnInteraction:!1,pagination:".swiper-pagination",paginationClickable:!0};1==data.imageResourcesList.length&&(swiperCfg.loop=!1);new Swiper("#indexSlider",swiperCfg)}else 0==data.code}})},loadList:function(){var pageBrokers=$("#pageBrokers").val(),brokers=$("#brokers").val();""!=pageBrokers&&(brokers=pageBrokers);var self=this,url=self.url.wapUrl+self.url.labelList,param={currentPage:1,pernum:1e4,requestType:"new",brokers:brokers};$.ajax({url:url,type:"get",dataType:"jsonp",data:param,success:function(data){if(data.result){if(1==data.code){var html=self.tpl.labelListTpl(data);$("#index_label_ul").html(html),$("#loading_lists").hide(),self.drawLabelCircle()}else if(0==data.code){var html="<p class='text-center ' style='padding:50px'>暂无列表数据<p>";$("#loading_lists").hide(),$("#index_label_ul").html(html)}}else{var html="<p class='text-center ' style='padding:50px'>"+data.msg+"<p>";$("#index_label_ul").html(html)}}})},drawLabelCircle:function(){function drawCircle(opt){var ctx=opt.ctx;ctx.save(),ctx.beginPath(),ctx.arc(opt.size/2,opt.size/2,opt.r,0,2*Math.PI),ctx.lineWidth=opt.lineWidth,ctx.strokeStyle=opt.color,ctx.stroke(),ctx.restore()}function animateCircle(opt){var ctx=opt.ctx;ctx.save();var animateTime=(opt.progress,400),stepTime=20,count=animateTime/stepTime,totalArc=opt.progress/100*Math.PI*2,i=1,startArc=.5*-Math.PI,timer=setInterval(function(){var endArc=totalArc*i/count+startArc;ctx.beginPath(),ctx.arc(opt.size/2,opt.size/2,opt.r,startArc,endArc),ctx.lineWidth=opt.lineWidth,ctx.strokeStyle=opt.color,ctx.stroke(),i+=1,i==count&&clearInterval(timer)},stepTime);ctx.restore()}var grayCircleOpt,yellowCircleOpt,dpr=1==window.dpr?2:window.dpr;$(".label_canvas").each(function(index,item){var $canvas=$(item),progress=$canvas.attr("data-progress"),size=$canvas.width()*dpr;$canvas.attr("width",size).attr("height",size);var ctx=$canvas[0].getContext("2d"),lineWidth=3*dpr;grayCircleOpt={ctx:ctx,size:size,r:(size-2*lineWidth)/2,lineWidth:lineWidth,color:"#fdeadd"},yellowCircleOpt={ctx:ctx,progress:progress,size:size,r:(size-2*lineWidth)/2,lineWidth:lineWidth,color:"#fd9438"},drawCircle(grayCircleOpt),animateCircle(yellowCircleOpt)})}},app=new App})});