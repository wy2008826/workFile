define(function(require,exports,module){require("zepto"),require("fastclick"),FastClick.attach(document.body),$(function(){function moneyFix(value){var f=parseFloat(value);if(isNaN(f))return!1;var f=Math.round(100*value)/100,s=f.toString(),rs=s.indexOf(".");for(0>rs&&(rs=s.length,s+=".");s.length<=rs+2;)s+="0";return s}function accMul(arg1,arg2){var m=0,s1=arg1.toString(),s2=arg2.toString();try{m+=s1.split(".")[1].length}catch(e){}try{m+=s2.split(".")[1].length}catch(e){}return Number(s1.replace(".",""))*Number(s2.replace(".",""))/Math.pow(10,m)}function Subtr(arg1,arg2){var r1,r2,m,n;try{r1=arg1.toString().split(".")[1].length}catch(e){r1=0}try{r2=arg2.toString().split(".")[1].length}catch(e){r2=0}return m=Math.pow(10,Math.max(r1,r2)),n=r1>=r2?r1:r2,((arg1*m-arg2*m)/m).toFixed(n)}function validateAll(){var money=Number($("#money").val().trim()),payPassword=$("#payPassword").val(),bankId=$("#accountBankId").val().trim(),bankBranch=$("#branch").val().trim(),isza=$("#isza").val().trim(),freeCashFees=Number($("#freeCashFees").text()),useMoney=Number($("#useMoney").text()),fee=0,credited=0;if(money>useMoney&&require.async("layerCss",function(){require.async("layer",function(layer){layer.open({content:"提现金额超限",className:"layer-tip",time:2,end:function(){return layer.closeAll(),!1}})})}),null==money||""==money)return $("#fees").text("0.00"),!1;if(0==isza)if(money>freeCashFees)if(Subtr(money,freeCashFees)<1)credited=freeCashFees,fee=Subtr(money,credited);else{fee=accMul(Subtr(money,freeCashFees),.005),1>fee&&(fee=1);var array=fee.toString().split(".");array.length>1&&array[1].length>2&&(fee=array[0]+"."+array[1].substr(0,2)),credited=Subtr(money,fee)}else credited=money;else credited=money,fee=0;var newFee=moneyFix(fee);return $("#fees").text(newFee),""!=money&&useMoney>=money&&1e6>=money&&money>=1&&""!=payPassword&&""!=bankId&&""!=bankBranch?!0:void 0}function popLayer(){var html='<div class="fc-31 fs-24 pop-layer"><p>为了保障用户资金安全，本平台现已施行<span class="fc-primary">同卡进出</span>制度。</p><p>绑定其他银行卡需要通过充值来完成，且该银行卡将作为移动端唯一充值提现卡（若您绑定过其他银行卡，则将失效）。</p><p>修改流程较复杂，建议谨慎绑卡。</p><p>若您仍想使用多张银行卡进行充值提现，请登录网页端操作，对您造成的不便请您谅解。</p></div>';require.async("layerCss",function(){require.async("layer",function(layer){layer.open({title:["重要提示","background-color:#fff;color:#313131;"],content:html,type:1,shadeClose:!1,btn:["继续充值","下次再说"],yes:function(){location.href=wapurl+"/member/recharge.html?type=new"},no:function(){layer.closeAll()}})})})}var wapurl=$("#wapurl").val();$("#cashRule").on("click",function(){location.href=wapurl+"/member/cashRule.html"}),$("#forgetPayPwd").on("click",function(){location.href=wapurl+"/passport/forgetPayPwd.html"});var moreEle=$(".cash-side li"),moreCard=moreEle.length;moreCard>=2&&($("#accountBankId").val(moreEle.eq(0).attr("data-id")),$("#bankIcon").attr("src",moreEle.eq(0).find("img").attr("src")),$("#bankInfo").text(moreEle.eq(0).find("span").text()),$("#branch").val(moreEle.eq(0).attr("data-branch"))),$("#moreBank").on("click",function(){$("#cashShade").removeClass("hide"),$(".cash-side").removeClass("hide")}),$("#cashShade").on("click",function(){$(this).addClass("hide"),$(".cash-side").addClass("hide")}),$(".cash-side li").on("click",function(){if(!$(this).hasClass("select-other")){var bankId=$(this).attr("data-id"),bankIcon=$(this).find("img").attr("src"),bankBranch=$(this).attr("data-branch"),bankText=$(this).find("span").text();$("#cashShade").addClass("hide"),$(".cash-side").addClass("hide"),$("#bankIcon").attr("src",bankIcon),$("#bankInfo").text(bankText),$("#accountBankId").val(bankId),$("#branch").val(bankBranch),$("#branch").attr("data-branch",bankBranch)}});var $submit=$("#form-btn");$("input").on("input",function(){var flag=validateAll();flag?$submit.removeClass("form-btn-dis"):$submit.addClass("form-btn-dis")}),$submit.on("click",function(){$submit.hasClass("form-btn-dis")||require.async("layerCss",function(){require.async("layer",function(layer){var money=moneyFix(1*$("#money").val().trim()),fees=$("#fees").text(),realMoney=moneyFix(money-fees),confirm='<div class="fc-31 fs-24 pop-layer"><div class="row"><span class="col-all-6 text-right">本次提现金额为</span><span class="col-all-6">￥'+money+'元</span></div><div class="row"><span class="col-all-6 text-right">手续费收取</span><span class="col-all-6">￥'+fees+'元</span></div><div class="row"><span class="col-all-6 text-right">实际到账金额为</span><span class="col-all-6">￥'+realMoney+"元</span></div></div>";layer.open({title:["请确认","background-color:#fff;color:#313131;"],content:confirm,type:1,shadeClose:!1,btn:["确认提现","取消"],yes:function(){layer.closeAll(),$.ajax({type:"get",url:wapurl+"/api/member/cash.html",dataType:"jsonp",contentType:"application/jsonp; charset=utf-8",data:{accountBankId:$("#accountBankId").val().trim(),money:$("#money").val().trim(),branch:$("#branch").val().trim(),password:$("#payPassword").val().trim()},success:function(data){if(data.result)location.href=wapurl+"/member/cashSuccess.html";else{var html='<div class="fc-31 fs-24 text-center pop-layer"><p>'+data.msg+"</p></div>";require.async("layerCss",function(){require.async("layer",function(layer){layer.open({content:html,type:1,shadeClose:!1,btn:["好的"],yes:function(){layer.closeAll()}})})})}}})}})})})}),$("#bindCard,#otherCard").on("click",function(){$("#cashShade").addClass("hide"),$(".cash-side").addClass("hide"),popLayer()}),$("#cashRecord").on("click",function(){location.href=wapurl+"/member/cashRecord.html"})})});