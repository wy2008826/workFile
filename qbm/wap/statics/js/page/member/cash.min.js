define(function(require,exports,module){require("zepto"),require("fastclick"),FastClick.attach(document.body),$(function(){function moneyFix(value){var f=parseFloat(value);if(isNaN(f))return!1;var f=Math.round(100*value)/100,s=f.toString(),rs=s.indexOf(".");for(rs<0&&(rs=s.length,s+=".");s.length<=rs+2;)s+="0";return s}function accDiv(arg1,arg2){var t1=0,t2=0,r1,r2;try{t1=arg1.toString().split(".")[1].length}catch(e){}try{t2=arg2.toString().split(".")[1].length}catch(e){}with(Math)return r1=Number(arg1.toString().replace(".","")),r2=Number(arg2.toString().replace(".","")),accMul(r1/r2,pow(10,t2-t1))}function accMul(arg1,arg2){var m=0,s1=arg1.toString(),s2=arg2.toString();try{m+=s1.split(".")[1].length}catch(e){}try{m+=s2.split(".")[1].length}catch(e){}return Number(s1.replace(".",""))*Number(s2.replace(".",""))/Math.pow(10,m)}function accAdd(arg1,arg2){var r1,r2,m;try{r1=arg1.toString().split(".")[1].length}catch(e){r1=0}try{r2=arg2.toString().split(".")[1].length}catch(e){r2=0}return m=Math.pow(10,Math.max(r1,r2)),(arg1*m+arg2*m)/m}function Subtr(arg1,arg2){var r1,r2,m,n;try{r1=arg1.toString().split(".")[1].length}catch(e){r1=0}try{r2=arg2.toString().split(".")[1].length}catch(e){r2=0}return m=Math.pow(10,Math.max(r1,r2)),n=r1>=r2?r1:r2,((arg1*m-arg2*m)/m).toFixed(n)}function cashFeeFun(){freeTimes=$("#freeTimes").val(),ticketId=$("#ticketId").val(),money=$("#money").val(),""!=money?setTimeout(function(){$.ajax({type:"get",url:wapurl+"/wap/countFreeMoney.html?remainTimes="+freeTimes+"&ticketId="+ticketId+"&money="+money+"&randomTime="+(new Date).getTime(),dataType:"jsonp",jsonp:"callback",jsonpCallback:"jsonpCallback",success:function(data){$("#fees").text(data.fee),$("#realMoney").val(data.credited)}})},300):$("#fees").text("0.00")}function validateAll(){var money=Number($("#money").val().trim()),payPassword=$("#payPassword").val(),bankId=$("#accountBankId").val().trim(),bankBranch=$("#branch").val().trim(),useMoney=($("#isza").val().trim(),Number($("#freeCashFees").text()),Number($("#useMoney").text()));return money>useMoney&&require.async("layerCss",function(){require.async("layer",function(layer){layer.open({content:"提现金额超限",className:"layer-tip",time:2,end:function(){return layer.closeAll(),$("#money").val(""),!1}})})}),money<=1&&require.async("layerCss",function(){require.async("layer",function(layer){layer.open({content:"提现金额须大于1元",className:"layer-tip",time:2,end:function(){return layer.closeAll(),!1}})})}),null==money||""==money?($("#fees").text("0.00"),!1):""!=money&&money<=useMoney&&money<=1e6&&money>=1&&""!=payPassword&&""!=bankId&&""!=bankBranch||void 0}function popLayer(){var html='<div class="fc-31 fs-24 pop-layer"><p>为了保障用户资金安全，本平台现已施行<span class="fc-primary">同卡进出</span>制度。</p><p>绑定其他银行卡需要通过充值来完成，且该银行卡将作为移动端唯一充值提现卡（若您绑定过其他银行卡，则将失效）。</p><p>修改流程较复杂，建议谨慎绑卡。</p><p>若您仍想使用多张银行卡进行充值提现，请登录网页端操作，对您造成的不便请您谅解。</p></div>';require.async("layerCss",function(){require.async("layer",function(layer){layer.open({title:["重要提示","background-color:#fff;color:#313131;"],content:html,type:1,shadeClose:!1,btn:["继续充值","下次再说"],yes:function(){location.href=wapurl+"/member/recharge.html?type=new"},no:function(){layer.closeAll()}})})})}var wapurl=$("#wapurl").val();$("#cashRule,.cash-tip").on("click",function(){location.href=wapurl+"/member/cashRule.html"}),$("#forgetPayPwd").on("click",function(){location.href=wapurl+"/passport/forgetPayPwd.html"});var moreEle=$(".cash-side li"),moreCard=moreEle.length;moreCard>=2&&($("#accountBankId").val(moreEle.eq(0).attr("data-id")),$("#bankIcon").attr("src",moreEle.eq(0).find("img").attr("src")),$("#bankInfo").text(moreEle.eq(0).find("span").text()),$("#branch").val(moreEle.eq(0).attr("data-branch"))),$("#moreBank").on("click",function(){$("#cashShade").removeClass("hide"),$(".cash-side").removeClass("hide")}),$("#cashShade").on("click",function(){$(this).addClass("hide"),$(".cash-side").addClass("hide")}),$(".cash-side li").on("click",function(){if(!$(this).hasClass("select-other")){var bankId=$(this).attr("data-id"),bankIcon=$(this).find("img").attr("src"),bankBranch=$(this).attr("data-branch"),bankText=$(this).find("span").text();$("#cashShade").addClass("hide"),$(".cash-side").addClass("hide"),$("#bankIcon").attr("src",bankIcon),$("#bankInfo").text(bankText),$("#accountBankId").val(bankId),$("#branch").val(bankBranch),$("#branch").attr("data-branch",bankBranch)}}),$("#selectCoupon").on("click",function(){require.async("artTemplate",function(template){require.async("artTemplateHelper",function(){template.helper("couponSelctedClass",function(status){var ticketId=$("#ticketId").val();if(status==ticketId)return"active"}),$.ajax({type:"get",url:wapurl+"/api/member/cashCoupon.html?flag=0&page=1&pageSize=10",dataType:"jsonp",jsonp:"callback",jsonpCallback:"jsonpCallback",success:function(data){var render=template.compile($("#couponListTpl").html()),html=render(data);require.async("layerCss",function(){require.async("layer",function(layer){layer.open({type:1,shadeClose:!1,content:html,success:function(){}})})})}})})})}),$(document).on({click:function(){layer.closeAll()}},"#closeBtn"),$(document).on({click:function(){var ticketId=$(this).attr("data-id"),isActive=$(this).hasClass("active");isActive?($("#ticketId").val("0"),$("#selectTipText").text("您有可使用的优惠券"),$("#seletedText").text("选择"),$(".layer-coupon-wrap .coupon-opt").removeClass("active")):($("#ticketId").val(ticketId),$("#selectTipText").text("已选择1张优惠券"),$("#seletedText").text("更换"),$(".layer-coupon-wrap .coupon-opt").removeClass("active"),$(this).addClass("active")),cashFeeFun(),setTimeout(function(){layer.closeAll()},200)}},".coupon-opt"),$("#money").on("input",function(){cashFeeFun()});var $submit=$("#form-btn");$("input").on("input",function(){var flag=validateAll();flag?$submit.removeClass("form-btn-dis"):$submit.addClass("form-btn-dis")}),$submit.on("click",function(){$submit.hasClass("form-btn-dis")||require.async("layerCss",function(){require.async("layer",function(layer){var money=moneyFix(1*$("#money").val().trim()),fees=$("#fees").text(),realMoney=$("#realMoney").val(),confirm='<div class="fc-31 fs-24 pop-layer"><div class="row"><span class="col-all-6 text-right">本次提现金额为</span><span class="col-all-6">￥'+money+'</span></div><div class="row"><span class="col-all-6 text-right">提现费用</span><span class="col-all-6">￥'+fees+'</span></div><div class="row"><span class="col-all-6 text-right">实际到账金额为</span><span class="col-all-6">￥'+realMoney+"</span></div></div>";layer.open({title:["请确认","background-color:#fff;color:#313131;"],content:confirm,type:1,shadeClose:!1,btn:["确认提现","取消"],yes:function(){layer.closeAll(),$.ajax({type:"get",url:wapurl+"/api/member/cash.html",dataType:"jsonp",contentType:"application/jsonp; charset=utf-8",data:{accountBankId:$("#accountBankId").val().trim(),ticketId:$("#ticketId").val().trim(),money:$("#money").val().trim(),branch:$("#branch").val().trim(),ticketId:$("#ticketId").val().trim(),password:$("#payPassword").val().trim()},success:function(data){if(data.result)location.href=wapurl+"/member/cashSuccess.html";else{var html='<div class="fc-31 fs-24 text-center pop-layer"><p>'+data.msg+"</p></div>";require.async("layerCss",function(){require.async("layer",function(layer){layer.open({content:html,type:1,shadeClose:!1,btn:["好的"],yes:function(){layer.closeAll()}})})})}}})}})})})}),$("#bindCard,#otherCard").on("click",function(){$("#cashShade").addClass("hide"),$(".cash-side").addClass("hide"),popLayer()}),$("#cashRecord").on("click",function(){location.href=wapurl+"/member/cashRecord.html"})})});