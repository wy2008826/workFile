define(function(require,exports,module){require("zepto"),require("fastclick"),FastClick.attach(document.body),$(function(){function GetQueryString(name){var reg=new RegExp("(^|&)"+name+"=([^&]*)(&|$)"),r=window.location.search.substr(1).match(reg);return null!=r?unescape(r[2]):null}var weburl=$("#weburl").val(),userId=($("#wapurl").val(),$("#wapcdnpath").val(),GetQueryString("userId"));require.async("artTemplate",function(template){function inviteRecordList(param,page){return!isGetting&&(tabOneHasAllLoad||tabTwoHasAllLoad?void $(".load_text").text("加载完毕").removeClass("hide"):(isGetting=!0,$(".load_text").text("加载中").removeClass("hide"),void $.ajax({type:"get",url:weburl+"/api/getInviteHistory.html?investmentType="+param+"&pageSize="+pageSize+"&page="+page+"&user_id="+userId,dataType:"jsonp",success:function(data){isGetting=!1,data.dataList.length<pageSize?((param=1)?tabOneHasAllLoad=!0:tabTwoHasAllLoad=!0,$(".load_text").text("加载完毕").removeClass("hide")):$(".load_text").text("加载更多").addClass("hide"),0==param?data.dataList.length>0&&($("#investment-friend").append(investment(data)),tabTwoPage++):1==param&&data.dataList.length>0&&($("#investment-friend").append(investment(data)),tabOnePage++)}})))}var pages,isGetting=!1,pageSize=15,tabOnePage=1,tabTwoPage=1,tabOneHasAllLoad=!1,tabTwoHasAllLoad=!1;template.helper("secondDotNum",function(num){return num.toFixed(2)}),$("header a").click(function(){$(".load_text").addClass("hide"),tabOnePage=1,tabTwoPage=1,tabOneHasAllLoad=!1,tabTwoHasAllLoad=!1,$("#investment-friend").html(""),$("header a").removeClass("change"),$(this).addClass("change");var index=$(this).index();0==index?inviteRecordList(1,tabOnePage):inviteRecordList(0,tabTwoPage)}),inviteRecordList(1,tabOnePage);var investment=template("inve-friendlist");window.onscroll=function(){var wH=$(window).height(),bodyH=$("body").height(),scrollTop=$("body").scrollTop(),index=$("header a.change").index();scrollTop+wH>bodyH-50&&(0==index?tabOnePage<=pages||!pages?inviteRecordList(1,tabOnePage):$(".load_text").removeClass("hide"):tabTwoPage<=pages||!pages?inviteRecordList(0,tabTwoPage):$(".load_text").removeClass("hide"))}}),$("body").on("click","#investment-friend .goactive",function(){var $elem=$(this),id=$(this).parents(".recordfriend-list").attr("data-id"),userId=$(this).parents(".recordfriend-list").attr("data-val");$elem.hasClass("disabled")||$.ajax({type:"get",url:weburl+"/hongbao/inviteFriendRemind.html?user_id="+userId+"&id="+id,dataType:"jsonp",success:function(data){1==data.code||2==data.code?layer.open({content:"<p class='normal-tip-line'>已通过短息提醒好友，24小时后方可再次提醒</p>",className:"layer-tip",time:1,type:1,end:function(){$elem.addClass("disabled").html("已提醒")}}):0==data.code?alert("系统异常，请稍后再试"):console.log("error")},error:function(){console.log("error")}})})})});