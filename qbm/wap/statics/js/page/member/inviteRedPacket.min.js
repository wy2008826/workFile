define(function(require,exports,module){require("zepto"),require("fastclick"),template=require("artTemplate"),FastClick.attach(document.body),template.helper("rightBoxType",function(index){return index%3==0?"one":index%3==1?"two":"three"}),template.helper("beizhuHelper",function(accountLimit,timeLimit){var moneyText,qixianText;return moneyText=0==accountLimit?"投资金额不限":"投资满"+accountLimit+"元",qixianText=0==timeLimit?"投资期限不限":"投资满"+timeLimit+"天",moneyText+","+qixianText}),$(function(){var App=($("#weburl").val(),$("#wapurl").val(),$("#wapcdnpath").val(),$("#userId").val(),function(){this.webUrl=$("#weburl").val(),this.tpl={redPacketTpl:template("redPacket_lists_tpl")},this.url={wapurl:$("#wapurl").val(),webUrl:$("#weburl").val(),packetListUrl:"/wap/queryCanReceiveHblist.html",getPacketUrl:"/wap/receiveHongbao.html"},this.layerTip=function(msg,time){layer.open({content:"<p class='normal-tip-line'>"+msg+"</p>",className:"layer-tip",time:time})},this.GetQueryString=function(name){var reg=new RegExp("(^|&)"+name+"=([^&]*)(&|$)"),r=window.location.search.substr(1).match(reg);return null!=r?unescape(r[2]):null},this.init(),this.getPacket()});App.prototype={init:function(){var self=this;$("#lookPacket").on("click",function(){var href=self.url.wapurl+"/member/redPacket.html";location.href=href})},getPacket:function(){var self=this;$("#get_packet").on("click",function(){function getListSuccess(data){layer.open({content:self.tpl.redPacketTpl(data),type:1})}var $btn=$(this);if(!$btn.hasClass("disabled")&&1!=$btn.attr("isGetting")){var packetListUrl=self.url.wapurl+self.url.packetListUrl;$btn.attr("isGetting",1),$.ajax({type:"get",url:packetListUrl,dataType:"jsonp",success:function(data){$btn.attr("isGetting",0),data.code==-1?self.layerTip(data.msg,2):getListSuccess(data)},error:function(){}})}}),$("body").on("click",".redPacket_lists .right_get_box",function(){function getPacketSuccess(data){var account=data.receivedHb,num=data.hongbaoNum;data.code!=-1?($em.addClass("disabled"),$("#hasGetNum").html(account),$("#hongbao_num").html(num),0==num&&$("#get_packet").html("您暂无红包可领取").addClass("disabled")):self.layerTip(data.msg,2)}var $em=$(this);if(!$em.hasClass("disabled")&&1!=$em.attr("isGetting")){var url=self.url.wapurl+self.url.getPacketUrl,postData={id:$em.attr("data-id")};$em.attr("isGetting",1),$.ajax({type:"get",url:url,data:postData,dataType:"jsonp",success:function(data){$em.attr("isGetting",0),getPacketSuccess(data)},error:function(){}})}})}},app=new App})});