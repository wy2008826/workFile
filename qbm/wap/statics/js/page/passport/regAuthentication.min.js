define(function(require,exports,module){require("zepto"),require("fastclick"),FastClick.attach(document.body),$(function(){var App=function(){this.url={wapUrl:$("#wapurl").val(),authenUrl:"/api/member/modifyRealName.html"},this.getParam=function(key){for(var href=window.location.href,index=href.indexOf("?"),hashArr=href.substr(index+1).split("?")[0].split("&"),i=0;i<hashArr.length;i++){var group=hashArr[i].split("=");if(group[0]==key)return group[1]}},this.init(),this.validateForm()};App.prototype={init:function(){$("body").on("click",".tap-link",function(e){e.preventDefault(),e.stopPropagation();var href=$(this).attr("data-href");window.location.href=href}),$("body").on("click",".layermbtn span",function(){layer.closeAll()}),$("input").focus(function(){$(this).closest(".list_item").addClass("active")}),$("input").blur(function(elem){$(this).closest(".list_item").removeClass("active")})},validateForm:function(){function isIdCardNo(num){var intCheckDigit,factorArr=new Array(7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2,1),parityBit=new Array("1","0","X","9","8","7","6","5","4","3","2"),varArray=new Array,lngProduct=0,intStrLen=num.length,idNumber=num;if(15!=intStrLen&&18!=intStrLen)return!1;for(i=0;i<intStrLen;i++){if(varArray[i]=idNumber.charAt(i),(varArray[i]<"0"||varArray[i]>"9")&&17!=i)return!1;i<17&&(varArray[i]=varArray[i]*factorArr[i])}if(18==intStrLen){var date8=idNumber.substring(6,14);if(0==isDate8(date8))return!1;for(i=0;i<17;i++)lngProduct+=varArray[i];if(intCheckDigit=parityBit[lngProduct%11],varArray[17]!=intCheckDigit)return!1}else{var date6=idNumber.substring(6,12);if(0==isDate6(date6))return!1}return!0}function isDate6(sDate){if(!/^[0-9]{6}$/.test(sDate))return!1;var year,month;return year=sDate.substring(0,4),month=sDate.substring(4,6),1700>year||year>2500?!1:1>month||month>12?!1:!0}function isDate8(sDate){if(!/^[0-9]{8}$/.test(sDate))return!1;var year,month,day;year=sDate.substring(0,4),month=sDate.substring(4,6),day=sDate.substring(6,8);var iaMonthDays=[31,28,31,30,31,30,31,31,30,31,30,31];return 1700>year||year>2500?!1:((year%4==0&&year%100!=0||year%400==0)&&(iaMonthDays[1]=29),1>month||month>12?!1:1>day||day>iaMonthDays[month-1]?!1:!0)}function validateAll(){var nameVal=$realName.val().trim(),idVal=$IDCard.val().trim();return nameVal.length>=2&&isIdCardNo(idVal)?!0:!1}function submitSuccess(){layer.open({content:"恭喜您实名认证成功了，快去理财吧！",time:2,shadeClose:!1,className:"layer-tip",end:function(){var href=self.url.wapUrl+"/index.html";setTimeout(function(){$(".login_form_ul .icon-gouxuan").removeClass("hide"),window.location.href=href},300)}})}require("layer");var self=this,$realName=$("#realName"),$IDCard=$("#IDCard"),$submit=$("#submit");$("input").on("input",function(){var validated=($(this),validateAll());validated?$submit.removeClass("disabled"):$submit.addClass("disabled")}),$submit.click(function(){if(!$submit.hasClass("disabled")){var params={realName:$realName.val(),cardId:$IDCard.val()};$.ajax({url:self.url.wapUrl+self.url.authenUrl,type:"get",data:params,dataType:"jsonp",success:function(data){if(data.result)data.result&&submitSuccess();else if(-1==data.code){var html="<p class='text-center lh-40'>访问已超时，请重新登录！</p>";self.alertMes(html),setTimeout(function(){var href=self.url.wapUrl+"/passport/login.html";window.location.href=href},2e3)}else{var msg=data.msg,html="<p class='lh-50 text-center'>失败原因："+msg+"</p><p class='lh-50 text-center'>如有疑问，请联系客服：400-606-7066</p>";layer.open({content:html,type:1,className:"hasPadding",shadeClose:!1,btn:["好的"]})}},error:function(){}})}})}};new App})});