define(function(require,module,exports){require("zepto"),require("fastclick"),FastClick.attach(document.body),$(function(){var App=function(){this.url={wapUrl:$("#wapurl").val(),submitTelUrl:"/api/doLogin.html"},this.layerComponent=function(options){"<h4 class='my-layer-title'>"+options.title+"</h4>",options.content},this.getParam=function(key){for(var href=window.location.href,index=href.indexOf("?"),hashArr=href.substr(index+1).split("?")[0].split("&"),i=0;i<hashArr.length;i++){var group=hashArr[i].split("=");if(group[0]==key)return group[1]}},this.pagePhone=this.getParam("phoneNumber"),this.referBackUrl={borrowDetail:this.url.wapUrl+"/wap/getBorrowInfo.html?borrow_id="+this.getParam("borrow_id")},this.init(),this.submitForm()};App.prototype={init:function(){function checkPwd(){var value=$("#passportInput").val().trim();""!=value&&value.length>=6&&value.length<=12?$next.removeClass("disabled"):$next.addClass("disabled")}var self=this;self.pagePhone&&$("#phoneVal").text(self.pagePhone),$("body").on("click",".layermbtn span",function(){layer.closeAll()}),$("body").on("click","#forgetPwd",function(){var $elem=$(this),href=$elem.attr("data-href");window.location.href=href+"?phoneNumber="+self.pagePhone}),$("input").focus(function(elem){var $inp=$(this);$inp.closest(".list_item").addClass("active");$inp.focus()}),$("input").blur(function(elem){var $inp=$(this);$inp.closest(".list_item").removeClass("active")});var $next=$("#submit");$("#passportInput")[0].addEventListener("input",function(){checkPwd()}),checkPwd()},submitForm:function(){var self=this;require("layer"),$("#submit").on("click",function(e){if($(this).hasClass("disabled"))return!1;var $passInp=$("#passportInput"),passVal=$passInp.val(),brokersVal=$("#brokers").val();e.preventDefault();var parm={brokers:brokersVal,password:passVal,username:self.pagePhone},url=self.url.wapUrl+self.url.submitTelUrl;$.ajax({url:url,type:"get",dataType:"jsonp",data:parm,success:function(data){if("string"==typeof data&&(data=$.parseJSON(data)),data.result){if("-1"==data.code){if(2==data.status)var html=(data.times,"<p class='mg-b-20 lh-40'>抱歉，您输入的登录密码不正确，请注意区分大小写，如果忘记密码，可以点击“忘记密码”进行找回</p>");else var html="<p class='mg-b-20 lh-40'>"+data.msg+"</p>";layer.open({content:html,type:1,shadeClose:!1,btn:["好的"]})}else if(1==data.code){var url=self.url.wapUrl+"/index.html",referBackType=self.getParam("referBack");referBackType&&(url=self.referBackUrl[referBackType]),window.location.href=url}}else{var html="<p class='mg-b-20 lh-40'>"+data.msg+"</p>";layer.open({content:html,type:1,shadeClose:!1,btn:["好的"]})}}})})}};new App})});