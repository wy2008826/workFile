define(function(require,module,exports){require("zepto"),require("fastclick"),FastClick.attach(document.body),$(function(){var App=function(){this.url={wapUrl:$("#wapurl").val(),webUrl:$("#weburl").val(),refeshImgUrl:"",getCodeUrl:"/api/getPhoneRegCode.html",submitUrl:"/api/doReg.html"},this.match={rule:function(val,reg,required){return val.search(reg)<0?!1:!0}},this.getParam=function(key){for(var href=window.location.href,index=href.indexOf("?"),hashArr=href.substr(index+1).split("?")[0].split("&"),i=0;i<hashArr.length;i++){var group=hashArr[i].split("=");if(group[0]==key)return group[1]}},this.pagePhone=this.getParam("phoneNumber"),this.alertMsg={imgIsEmpty:"<p class='lh-40 text-center'>抱歉，您输入的图形验证码不正确</p>",imgIsError:"<p class='lh-40 text-center'>抱歉，您输入的图形验证码不正确</p>",mesIsError:"<p class='lh-40 text-center'>抱歉，您输入的验证码不正确，可以点击“重发”再次获取短信</p>",passNotRight:"<p class='lh-40 text-center'>登录密码格式不正确（正确格式：6-12位数字加字母组合）</p>",passIsNotEqual:"<p class='lh-40 text-center'>两次输入的登录密码不一致</p>",tuijianWrong:"<p class='lh-40 text-center'>推荐人手机号码格式不正确</p>",tuijianIsNotExist:"<p class='lh-40 text-center'>推荐人不存在</p>"},this.tipAlert=function(html){layer.open({content:html,className:"layer-tip",time:2,shadeClose:!1})},this.alertMes=function(html){layer.open({content:html,shadeClose:!1,type:1,className:"hasPadding",btn:["好的"]})},this.init(),this.refeshImgAndCode(),this.validateForm()};App.prototype={init:function(){var self=this;self.pagePhone&&$("#pagePhone").text(self.pagePhone),$("body").on("click",".layermbtn span",function(){layer.closeAll()}),$("body").on("click",".tap-link",function(e){e.preventDefault(),e.stopPropagation();var href=$(this).attr("data-href");window.location.href=href}),$("input").focus(function(){var $inp=$(this);$inp.closest(".list_item").addClass("active")}),$("input").blur(function(elem){var $inp=$(this);$inp.closest(".list_item").removeClass("active")});var times=$("#times").val().trim();times>3&&$("#imgRow").removeClass("hide")},refeshImgAndCode:function(){function setTimer(){var timeInner=timeout;$getCode.addClass("disabled").text(timeInner+"s");var timer=setInterval(function(){timeInner-=1,$getCode.text(timeInner+"s"),0>=timeInner&&($kefuMes.removeClass("hide"),$getCode.removeClass("disabled").text("重发"),$("#telMesInput").val().trim()||$kefuMes.show(),clearInterval(timer))},1e3)}var self=this,imgReg=/^\d{4,4}$/,$imgRow=$("#imgRow"),$imgRandomWraper=$("#img_random_wraper").eq(0),$imgRandom=$("#img_random"),$refeshImg=$("#refresh_img"),$getCode=$("#getCode"),$passportSea=$("#passportSea"),$pwdInput0=$("#pwdInput0"),$pwdInput1=$("#pwdInput1"),$kefuMes=$("#kefuMes");$imgRandomWraper.on("click",function(){function imgLoaded(){$refeshImg.removeClass("animate")}if(!$refeshImg.hasClass("animate")){$imgRandom.unbind("load");var oldSrc=$imgRandom.attr("src").split("?")[0],now=1*new Date;$imgRandom.attr("src",oldSrc+"?"+now),$refeshImg.addClass("animate"),$imgRandom.on("load",imgLoaded.bind($imgRandom[0]))}}),$getCode.on("click",function(){var url=self.url.wapUrl+self.url.getCodeUrl,verifyCode=$("#imgInput").val().trim();if($(this).text("重发"),!$imgRow.hasClass("hide")){if(!verifyCode){var html="<p class='text-center lh-40'>图形验证码不能为空</p>";return self.tipAlert(html),!1}if(!imgReg.test(verifyCode)){var html="<p class='text-center lh-40'>图形验证码格式不正确</p>";return self.tipAlert(html),!1}}var params={Phone:self.pagePhone,verify:verifyCode};$(this).hasClass("disabled")||$.ajax({url:url,type:"get",dataType:"jsonp",data:params,success:function(data){if("string"==typeof data&&(data=$.parseJSON(data)),data.result)data.times>=3&&$("#imgRow").removeClass("hide"),setTimer();else{if(2==data.status){var html="<p class='lh-40 text-center'>"+data.msg+"</p>";return self.alertMes(html),!1}var html="<p class='lh-40 text-center'>"+data.msg+"</p>";self.alertMes(html)}},error:function(){}})}),$passportSea.on("click",function(){var type=$pwdInput0.attr("type");"text"==type?($pwdInput0.attr("type","password"),$pwdInput1.attr("type","password"),$passportSea.removeClass("icon-kejian").addClass("icon-bukejian")):($pwdInput0.attr("type","text"),$pwdInput1.attr("type","text"),$passportSea.removeClass("icon-bukejian").addClass("icon-kejian"))});var timeout=60},validateForm:function(){function validateAll(){var imgVal=$imgInput.val().trim(),telMesVal=$telMesInput.val().trim(),pswVal0=$pwdInput0.val().trim(),pswVal1=$pwdInput1.val().trim();$tuijianInput.val().trim();return""!=telMesVal&&""!=pswVal0&&""!=pswVal1?$imgRow.hasClass("hide")?!0:""!=imgVal?!0:!1:!1}require("layer");var self=this,telReg=/^1[34578]\d{9}$/,regPass=/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{6,12}$/,alertMes=self.alertMes,$imgRow=$("#imgRow"),$imgInput=$("#imgInput"),$telMesInput=$("#telMesInput"),$pwdInput0=$("#pwdInput0"),$pwdInput1=$("#pwdInput1"),$tuijianInput=$("#tuijianInput"),$submit=$("#submit");$("input").on("input",function(){var validated=($(this),validateAll());validated?$submit.removeClass("disabled"):$submit.addClass("disabled")}),$submit.click(function(){require.async("layer",function(){if(!$submit.hasClass("disabled")){if($pwdInput0.val()!=$pwdInput1.val()){var html=self.alertMsg.passIsNotEqual;return alertMes(html),!1}if(!regPass.test($pwdInput0.val())||!regPass.test($pwdInput1.val())){var html=self.alertMsg.passNotRight;return alertMes(html),!1}if(""!=$tuijianInput.val().trim()&&!self.match.rule($tuijianInput.val().trim(),telReg)){var html=self.alertMsg.tuijianWrong;return alertMes(html),!1}var href="../index.html";return window.location.href=href,!1}})})}};new App})});