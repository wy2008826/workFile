define(function(require,module,exports){require("zepto"),require("fastclick"),FastClick.attach(document.body),$(function(){var App=function(){this.url={wapUrl:$("#wapurl").val(),submitUrl:"/api/passport/security.html"},this.alertMsg={originIsError:"<p class='text-center lh-40'>原登录密码输入不正确</p>",passNotRight:"<p class='text-center lh-40'>抱歉，您输入的登录密码格式不正确，请输入6-12位数字加字母组合，区分大小写</p>",passIsNotEqual:"<p class='text-center lh-40'>两次输入的新登录密码不一致</p>"},this.alertMes=function(html){layer.open({content:html,shadeClose:!1,type:1,className:"hasPadding",btn:["好的"]})},this.init(),this.refeshImgAndCode(),this.validateForm()};App.prototype={init:function(){$("body").on("click",".layermbtn span",function(){layer.closeAll()}),$("input").focus(function(){var $inp=$(this);$inp.closest(".list_item").addClass("active")}),$("input").blur(function(elem){var $inp=$(this);$inp.closest(".list_item").removeClass("active")})},refeshImgAndCode:function(){var $passportSea=$("#passportSea"),$pwdInput0=$("#pwdInput0"),$pwdInput1=$("#pwdInput1");$passportSea.on("click",function(){var type=$pwdInput0.attr("type");"text"==type?($pwdInput0.attr("type","password"),$pwdInput1.attr("type","password"),$passportSea.removeClass("icon-kejian").addClass("icon-bukejian")):($pwdInput0.attr("type","text"),$pwdInput1.attr("type","text"),$passportSea.removeClass("icon-bukejian").addClass("icon-kejian"))})},validateForm:function(){function validateAll(){var pswValoriginVal=$pwdInputOrigin.val().trim(),pswVal0=$pwdInput0.val().trim(),pswVal1=$pwdInput1.val().trim();return""!=pswValoriginVal&&""!=pswVal0&&""!=pswVal1}function submitSuccess(){var html="<p class='text-center'>登录密码修改成功</p>";layer.open({content:html,shadeClose:!1,className:"layer-tip",time:2,end:function(){var href=self.url.wapUrl+"/member/setting.html";window.location.href=href}})}require("layer");var self=this,regPass=/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{6,12}$/,$pwdInputOrigin=$("#pwdInputOrigin"),$pwdInput0=$("#pwdInput0"),$pwdInput1=$("#pwdInput1"),$submit=$("#submit");$("input").on("input",function(){var validated=($(this),validateAll());validated?$submit.removeClass("disabled"):$submit.addClass("disabled")}),$submit.click(function(){var pswVal0=$pwdInput0.val().trim(),pswVal1=$pwdInput1.val().trim();if(!$submit.hasClass("disabled")){if($pwdInput0.val()!=$pwdInput1.val()){var html=self.alertMsg.passIsNotEqual;return self.alertMes(html),!1}if(!regPass.test($pwdInput0.val())||!regPass.test($pwdInput1.val())||pswVal0.length<6||pswVal0.length>12||pswVal1.length<6||pswVal1.length>12){var html=self.alertMsg.passNotRight;return self.alertMes(html),!1}var params={password:$pwdInputOrigin.val(),firstPwd:$pwdInput0.val(),secondPwd:$pwdInput1.val(),type:1};$.ajax({url:self.url.wapUrl+self.url.submitUrl,type:"get",dataType:"jsonp",data:params,success:function(data){if("string"==typeof data&&(data=JSON.parse(data)),data.result)data.result&&0==data.status&&submitSuccess();else if("-2"==data.status){var html=self.alertMsg.originIsError;self.alertMes(html)}else if(3==data.code){var html=self.alertMsg.passIsNotEqual;self.alertMes(html)}else if(4==data.code){var html=self.alertMsg.passNotRight;self.alertMes(html)}else if(data.code==-1){var html="<p class='text-center lh-40'>访问已超时，请重新登录！</p>";self.alertMes(html),setTimeout(function(){var href=self.url.wapUrl+"/passport/login.html";window.location.href=href},2e3)}else{var html="<p class='text-center lh-40'>"+data.msg+"</p>";self.alertMes(html)}}})}})}};new App})});