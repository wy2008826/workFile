define(function(require,module,exports){require("zepto"),require("fastclick"),FastClick.attach(document.body),$(function(){var App=function(){this.url={wapUrl:$("#wapurl").val(),loginByTelUrl:"/api/loginByPhone.html"},this.match={phone:function(val,required){var telReg=/^1[34578]\d{9}$/;return!(val.search(telReg)<0)}},this.getParam=function(key){for(var href=window.location.href,index=href.indexOf("?"),hashArr=href.substr(index+1).split("?")[0].split("&"),i=0;i<hashArr.length;i++){var group=hashArr[i].split("=");if(group[0]==key)return group[1]}},this.alertMes=function(html){layer.open({content:html,shadeClose:!1,type:1,className:"hasPadding",btn:["好的"]})},this.init(),this.submitForm()};App.prototype={init:function(){function matchTel(){var value=$tel.val(),matched=self.match.phone(value.trim());matched?$next.removeClass("disabled"):$next.addClass("disabled")}var self=this,$next=$("#next"),$tel=$("#tel"),$clearInput=$("#clearInput");$("body").on("click",".layermbtn span",function(){layer.closeAll()}),$("html").on("click",function(e){var $target=$(e.target),length=$target.closest(".list_item").length;if(0==length){var $inp=$tel;$inp.closest(".list_item").removeClass("active");$clearInput.addClass("hide")}else $tel.closest(".list_item").addClass("active"),$clearInput.removeClass("hide")}),$("#tel")[0].addEventListener("input",function(){matchTel()}),matchTel(),$clearInput.on("click",function(){$tel.val("")})},submitForm:function(){require("layer");var self=this;$("#next").on("click",function(e){$("#loginForm");if($(this).hasClass("disabled"))return!1;var $phoneInp=$("#tel"),phoneVal=$phoneInp.val(),brokersVal=$("#brokers").val();e.preventDefault(),$.ajax({url:self.url.wapUrl+self.url.loginByTelUrl+"?phoneNumber="+phoneVal+"&brokers="+brokersVal,type:"get",dataType:"jsonp",success:function(data){if(data.result)if("0"==data.status){var href=self.url.wapUrl+"/passport/reg.html?phoneNumber="+data.phoneNumber+"&brokers="+data.brokers;window.location.href=href}else if("-1"==data.status){var href=self.url.wapUrl+"/passport/enterPwd.html?phoneNumber="+data.phoneNumber+"&brokers="+data.brokers,referBack=self.getParam("referBack"),borrowId=self.getParam("borrow_id");referBack&&(href+="&referBack="+referBack),borrowId&&(href+="&borrow_id="+borrowId),window.location.href=href}else{var html="<p class='lh-40'>"+data.msg+"</p>";self.alertMes(html)}else{var html="<p class='lh-40'>"+data.msg+"</p>";self.alertMes(html)}}})})}},app=new App})});