define(function(require,exports,module){require("zepto"),require("fastclick"),template=require("artTemplate"),FastClick.attach(document.body),template.helper("status",function(type){return 1==type?"生效中":2==type?"冻结中":"已过期"}),template.helper("fixedNumber",function(money){return new Number(money).toFixed(2)}),template.helper("hideName",function(name){for(var length=name.length,firstName=name.substr(0,1),i=0;i<length-1;i++)firstName+="*";return firstName}),$(function(){var App=function(){this.url={wapUrl:$("#wapurl").val(),borrowLists:"/api/getBorrowDetail.html"},this.getParam=function(key){for(var href=window.location.href,index=href.indexOf("?"),hashArr=href.substr(index+1).split("?")[0].split("&"),i=0;i<hashArr.length;i++){var group=hashArr[i].split("=");if(group[0]==key)return group[1]}},this.tpl={listTpl:template.compile($("#listTpl").html())},this.borrow_id=this.getParam("borrow_id"),this.curPage=1,this.perNum=15,this.init(),this.loadBorrowLists()};App.prototype={init:function(){$("body").on("click",".tap-link",function(e){e.preventDefault(),e.stopPropagation();var href=$(this).attr("data-href");window.location.href=href})},loadBorrowLists:function(){function getListData(){var url=self.url.wapUrl+self.url.borrowLists,param={borrow_id:self.borrow_id,currentPage:self.curPage,perNum:self.perNum};return!isGetting&&!hasGetAll&&(isGetting=!0,void $.ajax({url:url,type:"get",dataType:"jsonp",data:param,success:function(data){if(data.result){var dataLength=data.borrowDetailsList.length;if(dataLength>0){var html=self.tpl.listTpl(data);$tableBody.append(html)}else if(0==dataLength&&1==self.curPage){var html="<p class='lh-70 text-center' style='margin:1rem auto;'>暂无资产清单！</p>";$tableBody.append(html),$loading_wraper.hide(),hasGetAll=!0}dataLength<self.perNum&&(hasGetAll=!0,setGetAllStatus()),hasGetAll||$loading_wraper.css({visibility:"hidden"})}else{var html="<p class='lh-70 text-center'>"+data.msg+"</p>";$tableBody.append(html)}self.curPage+=1,isGetting=!1}}))}function setGetAllStatus(){$loading_wraper.css({visibility:"visible"}),$loading_wraper.find(".loading_img").hide(),$loading_wraper.find(".loading_text").text("已经没有了")}function ScrollInifate(config){function scrollHandler(e){var bodyH=body.offsetHeight,scrollTop=body.scrollTop;scrollTop+wH>=bodyH-distance&&callBack(e,scrollTop)}var body=document.getElementsByTagName("body")[0],wH=window.innerHeight,distance=parseFloat(config.distance)||0,callBack=config.endCallBack;window.addEventListener("scroll",scrollHandler)}var self=this,$tableBody=$("#listTable"),$loading_wraper=$(".loading_wraper"),isGetting=!1,hasGetAll=!1;getListData(),ScrollInifate({distance:10,endCallBack:function(){$loading_wraper.css({visibility:"visible"}),hasGetAll&&setGetAllStatus(),getListData()}})}};new App})});