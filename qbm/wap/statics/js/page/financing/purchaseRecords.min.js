define(function(require,exports,module){require("zepto"),require("fastclick"),template=require("artTemplate"),FastClick.attach(document.body),template.helper("fixedNumber",function(money){return new Number(money).toFixed(2)}),template.helper("clipCenter",function(value){if(value.length>=2){var length=value.length;return value.substr(0,1)+"***"+value.substr(length-1,1)}return value}),$(function(){var App=function(){this.url={wapUrl:$("#wapurl").val(),purchaseLists:"/api/getTenderList.html"},this.getParam=function(key){for(var href=window.location.href,index=href.indexOf("?"),hashArr=href.substr(index+1).split("?")[0].split("&"),i=0;i<hashArr.length;i++){var group=hashArr[i].split("=");if(group[0]==key)return group[1]}},this.tpl={listTpl:template.compile($("#listTpl").html())},this.borrow_id=this.getParam("borrow_id"),this.curPage=1,this.perNum=15,this.init(),this.loadPurchaseLists()};App.prototype={init:function(){$("body").on("click",".tap-link",function(e){e.preventDefault(),e.stopPropagation();var href=$(this).attr("data-href");window.location.href=href})},loadPurchaseLists:function(){function getListData(){var url=self.url.wapUrl+self.url.purchaseLists,param={borrow_id:self.borrow_id,currentPage:self.curPage,pernum:self.perNum};return!isGetting&&!hasGetAll&&(isGetting=!0,void $.ajax({url:url,type:"get",dataType:"jsonp",data:param,success:function(data){if(data.result){if(data.dataList.length>0){var html=self.tpl.listTpl(data);$tableBody.append(html)}else if(0==data.dataList.length&&1==self.curPage){var html="<p class='lh-70 text-center' style='margin:1rem auto;'>暂无购买记录哦！</p>";$tableBody.append(html),$loading_wraper.hide(),hasGetAll=!0}data.dataList.length<self.perNum&&(hasGetAll=!0,setGetAllStatus()),hasGetAll||$loading_wraper.css({visibility:"hidden"})}else{var html="<p class='lh-70 text-center'>"+data.msg+"</p>";$tableBody.append(html)}self.curPage+=1,isGetting=!1}}))}function setGetAllStatus(){$loading_wraper.css({visibility:"visible"}),$loading_wraper.find(".loading_img").hide(),$loading_wraper.find(".loading_text").text("已经没有了")}function ScrollInifate(config){function scrollHandler(e){var bodyH=body.offsetHeight,scrollTop=body.scrollTop;scrollTop+wH>=bodyH-distance&&callBack(e,scrollTop)}var body=document.getElementsByTagName("body")[0],wH=window.innerHeight,distance=parseFloat(config.distance)||0,callBack=config.endCallBack;window.addEventListener("scroll",scrollHandler)}var self=this,$tableBody=$("#listTable"),$loading_wraper=$(".loading_wraper"),isGetting=!1,hasGetAll=!1;getListData(),ScrollInifate({distance:10,endCallBack:function(){$loading_wraper.css({visibility:"visible"}),hasGetAll&&setGetAllStatus(),getListData()}})}};new App})});