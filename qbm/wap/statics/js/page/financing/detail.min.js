define(function(require,exports,module){require("zepto"),require("fastclick"),FastClick.attach(document.body),$(function(){var App=function(){this.url={wapUrl:$("#wapurl").val(),borrowInfo:"/wap/getBorrowInfo.html",checkDxbMM:"/member/checkDirectionalMarkPwd.html"},this.getParam=function(key){for(var href=window.location.href,index=href.indexOf("?"),hashArr=href.substr(index+1).split("?")[0].split("&"),i=0;i<hashArr.length;i++){var group=hashArr[i].split("=");if(group[0]==key)return group[1]}},this.isIos=function(){var userAgent=window.navigator.userAgent;return userAgent.indexOf("iPhone")>=0}(),this.tipAlert=function(html){layer.open({content:html,className:"layer-tip",time:2,shadeClose:!1})},this.borrow_id=this.getParam("borrow_id"),this.redemptionType=$("#redemptionType").val(),this.init(),this.borrowTime(),this.xmmmBuy()};App.prototype={init:function(){var self=this,moneyAllInp=$("#money_all"),moneyLeftInp=$("#money_left"),moneyAllVal=moneyAllInp.val().trim(),moneyLeftVal=moneyLeftInp.val().trim(),scale=(moneyAllVal-moneyLeftVal)/moneyAllVal*100;$("#bar_inner").animate({width:scale+"%"},300),$("body").on("click",".tap-link",function(e){e.preventDefault(),e.stopPropagation();var $row=$(this);if($(this).hasClass("bg-default"))return!1;var href=$(this).attr("data-href")+"?borrow_id="+self.borrow_id,referBack=$(this).attr("data-refer-back");referBack&&(href+="&referBack="+referBack),$row.hasClass("redeemTypeRow")&&(href+="&redemptionType="+self.redemptionType),window.location.href=href});var $buyBtn=$("#buy_now");$buyBtn.length>0&&$buyBtn.on("click",function(){var realStatus=$("#realStatus").val();if(1==realStatus)var borrow_id=self.borrow_id,href=$(this).attr("data-href")+"?borrow_id="+borrow_id;else var href=self.url.wapUrl+"/member/authentication.html";window.location.href=href})},borrowTime:function(){function setDHMSFormate(endTime,dom,type){var sys_second1=endTime-systemTime,countDown=setInterval(function(){if(sys_second1>1){sys_second1-=1;var day1=Math.floor(sys_second1/3600/24),hour1=Math.floor(sys_second1/3600%24),minute1=Math.floor(sys_second1/60%60),second1=Math.floor(sys_second1%60),showDay1=day1,showHour1=hour1<10?"0"+hour1:hour1,showMinute1=minute1<10?"0"+minute1:minute1,showSecond1=second1<10?"0"+second1:second1;if("text"==type)var htmlStr=showDay1+"天"+showHour1+"小时"+showMinute1+"分"+showSecond1+"秒";else if(":"==type)var showDay1=showDay1?showDay1+"天":"",htmlStr=showDay1+showHour1+":"+showMinute1+":"+showSecond1+"秒后开售，敬请期待";$(dom).html(htmlStr)}else clearInterval(countDown),":"==type&&window.location.reload()},1e3)}var $borrowEndTime=$("#borrowEndTime"),$borrowStartTime=$("#borrowStartTime"),systemTime=$("#sysTime").val(),canBuyEnd=$borrowEndTime.attr("data-time-end"),notStartTime=$borrowStartTime.attr("data-time-end");canBuyEnd?setDHMSFormate(canBuyEnd,$borrowEndTime,"text"):notStartTime&&setDHMSFormate(notStartTime,$borrowStartTime,":")},xmmmBuy:function(){var self=this,$fix_xmmm=$("#fix_xmmm");if($fix_xmmm.length>0){var $xmmmInp=$("#xmmm_inp"),$xmmmBuy=$("#xmmm_buy");$xmmmInp.on("input",function(){var val=$(this).val();console.log(val),""!=val?$xmmmBuy.removeClass("disabled"):$xmmmBuy.addClass("disabled")}),self.isIos&&$xmmmInp.on("focus",function(){document.body.scrollTop=1e3,$fix_xmmm.removeClass("fix_xmmm"),$(".content").removeClass("pd_bottom")}).on("blur",function(){$fix_xmmm.addClass("fix_xmmm"),$(".content").addClass("pd_bottom")}),require("layer"),$xmmmBuy.on("click",function(){var isDisabled=$(this).hasClass("disabled");if(!isDisabled){var url=self.url.wapUrl+self.url.checkDxbMM,param={id:self.borrow_id,dmPwd:$xmmmInp.val()};$.ajax({type:"get",dataType:"jsonp",url:url,data:param,success:function(data){if(data.result){var realStatus=$("#realStatus").val();if(1==realStatus)var href=$xmmmBuy.attr("data-href")+"?borrow_id="+self.borrow_id;else var href=self.url.wapUrl+"/member/authentication.html";window.location.href=href}else if(0==data.result){var html="<p class='text-center lh-40'>"+data.msg+"</p>";self.tipAlert(html)}}})}})}}};new App})});